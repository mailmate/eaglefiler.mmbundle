#!/bin/bash

name=${MM_SUBJECT//:/_}

mkdir -p "$TMPDIR/com.freron.MailMate.EagleFiler"
tmpfile="$TMPDIR/com.freron.MailMate.EagleFiler/${name}.eml"
cat > "${tmpfile}"

url="message://%3c${MM_MESSAGE_ID}%3e"

# Tricky substitution to make it work for " and \ in the AppleScript below.
tmpfile=${tmpfile//\\/\\\\}
tmpfile=${tmpfile//\"/\\\"}

osascript <<END

tell application "EagleFiler"
	import files { "${tmpfile}" } source URL "${url}" with deleting afterwards
	-- asking for options boolean
end tell


END

# unlink "${tmpfile}" # Handled by EagleFiler
